# üöÄ Complete Deployment Guide - Step by Step

## Overview
- **Database & Auth**: Supabase (FREE, easier than AWS)
- **Hosting**: Vercel (FREE - includes custom domains!)
- **Domain**: Namecheap (you already own this)
- **Google OAuth**: FREE
- **SSL Certificates**: FREE (auto-generated by Vercel)

**Total Cost: $0** ‚úÖ

**‚úÖ All features are FREE:**
- Custom domain support on Vercel (free tier)
- SSL certificates (auto-generated, free)
- Supabase database & auth (free tier)
- Google OAuth (free)

---

## PART 1: Supabase Setup (Database + Auth)

### Step 1.1: Create Supabase Account
1. Go to **https://supabase.com**
2. Click **"Start your project"**
3. Sign up with **GitHub** (recommended) or email
4. Verify your email if needed

### Step 1.2: Create New Project
1. Click **"New Project"** button
2. Fill in:
   - **Name**: `ecofurnish` (or your choice)
   - **Database Password**: ‚ö†Ô∏è **SAVE THIS!** Write it down securely
     - Example: `MySecurePass123!@#`
   - **Region**: Choose closest to you (e.g., `Southeast Asia (Singapore)`)
   - **Pricing Plan**: Select **FREE**
3. Click **"Create new project"**
4. Wait 2-3 minutes for setup

### Step 1.3: Get Your Supabase Keys
1. In Supabase dashboard, go to **Settings** (gear icon) ‚Üí **API**
2. You'll see two keys:
   - **Project URL**: `https://xxxxx.supabase.co` ‚Üê Copy this
   - **anon public** key: `eyJhbGc...` ‚Üê **USE THIS ONE** (safe for frontend)
   - **service_role secret** key: `eyJhbGc...` ‚Üê **DO NOT USE** (keep secret, server-side only)
3. **Use the `anon public` key** - it's safe to use in your React app
4. **Never expose the `service_role` key** - it bypasses all security!

---

## PART 2: Database Setup

### Step 2.1: Create Database Tables
1. In Supabase dashboard, go to **SQL Editor** (left sidebar)
2. Click **"New query"**
3. Copy and paste **ALL** of this SQL:

```sql
-- User profiles (extends auth.users)
CREATE TABLE public.profiles (
  id UUID REFERENCES auth.users PRIMARY KEY,
  name TEXT,
  email TEXT,
  avatar_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Cart items
CREATE TABLE public.cart_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users ON DELETE CASCADE,
  product_id TEXT NOT NULL,
  quantity INTEGER DEFAULT 1,
  product_data JSONB, -- Stores full product info (name, price, image, category)
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, product_id)
);

-- Orders
CREATE TABLE public.orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users ON DELETE CASCADE,
  total_amount DECIMAL(10,2),
  status TEXT DEFAULT 'pending',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Order items
CREATE TABLE public.order_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_id UUID REFERENCES public.orders ON DELETE CASCADE,
  product_id TEXT NOT NULL,
  quantity INTEGER,
  price DECIMAL(10,2),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Newsletter subscribers
CREATE TABLE public.newsletter_subscribers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT NOT NULL UNIQUE,
  subscribed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  is_active BOOLEAN DEFAULT TRUE
);

-- Enable Row Level Security (RLS)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.cart_items ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.order_items ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.newsletter_subscribers ENABLE ROW LEVEL SECURITY;

-- Policies: Users can only see/edit their own data
CREATE POLICY "Users can view own profile" ON public.profiles
  FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can insert own profile" ON public.profiles
  FOR INSERT WITH CHECK (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON public.profiles
  FOR UPDATE USING (auth.uid() = id);

-- Database Trigger: Automatically create profile when user signs up
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email, name, avatar_url)
  VALUES (
    NEW.id,
    NEW.email,
    COALESCE(NEW.raw_user_meta_data->>'full_name', SPLIT_PART(NEW.email, '@', 1)),
    NEW.raw_user_meta_data->>'avatar_url'
  )
  ON CONFLICT (id) DO NOTHING;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

CREATE POLICY "Users can manage own cart" ON public.cart_items
  FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Users can view own orders" ON public.orders
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can create own orders" ON public.orders
  FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Newsletter: Anyone can subscribe (public insert, no auth required)
CREATE POLICY "Anyone can subscribe to newsletter" ON public.newsletter_subscribers
  FOR INSERT WITH CHECK (true);

CREATE POLICY "Anyone can view newsletter subscribers" ON public.newsletter_subscribers
  FOR SELECT USING (true);
```

4. Click **"Run"** (or press Ctrl+Enter)
5. You should see: ‚úÖ "Success. No rows returned"

---

## PART 3: Google OAuth Setup

### Step 3.1: Create Google Cloud Project
1. Go to **https://console.cloud.google.com**
2. Sign in with your Google account
3. Click **"Select a project"** ‚Üí **"New Project"**
4. Fill in:
   - **Project name**: `EcoFurnish` (or your choice)
   - Click **"Create"**
5. Wait a few seconds, then select the new project

### Step 3.2: Enable Google+ API
1. Go to **"APIs & Services"** ‚Üí **"Library"** (left sidebar)
2. Search for **"Google+ API"**
3. Click on it and click **"Enable"**

### Step 3.3: Create OAuth Credentials
1. Go to **"APIs & Services"** ‚Üí **"Credentials"**
2. Click **"Create Credentials"** ‚Üí **"OAuth client ID"**
3. If prompted, configure OAuth consent screen:
   - **User Type**: External
   - **App name**: `EcoFurnish`
   - **User support email**: `aadishravan40@gmail.com`
   - **Developer contact**: `aadishravan40@gmail.com`
   - Click **"Save and Continue"** through the steps
   - Click **"Back to Dashboard"**

4. Now create OAuth client:
   - **Application type**: **Web application**
   - **Name**: `EcoFurnish Web`
   - **Authorized redirect URIs**: 
     - Click **"Add URI"**
     - Enter: `https://YOUR-PROJECT-ID.supabase.co/auth/v1/callback`
     - Replace `YOUR-PROJECT-ID` with your actual Supabase project ID
     - Example: `https://abcdefghijklmnop.supabase.co/auth/v1/callback`
     - ‚ö†Ô∏è **This is the callback URL** - Supabase handles the OAuth callback here
   - Click **"Create"**

5. **IMPORTANT**: Copy these values:
   - **Client ID**: `123456789-abcdefg.apps.googleusercontent.com` ‚Üê Copy
   - **Client Secret**: `GOCSPX-xxxxx` ‚Üê Copy
   - ‚ö†Ô∏è **SAVE THESE!** You'll need them next

### Step 3.4: Configure Google in Supabase
1. Go back to **Supabase dashboard**
2. Go to **Authentication** ‚Üí **Providers** (left sidebar)
3. Find **"Google"** and click on it
4. Toggle **"Enable Google provider"** to ON
5. Paste:
   - **Client ID (for Google OAuth)**: Your Google Client ID
   - **Client Secret (for Google OAuth)**: Your Google Client Secret
6. Click **"Save"**

---

## PART 4: Local Environment Setup

### Step 4.1: Create Environment File
1. In your project root, create `.env.local` file
2. Add these lines (replace with YOUR values):

```bash
VITE_SUPABASE_URL=https://YOUR-PROJECT-ID.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-public-key-here
```

**‚ö†Ô∏è Important**: Use the **`anon public` key**, NOT the `service_role secret` key!
- ‚úÖ **anon key** = Safe for frontend (what we use)
- ‚ùå **service_role key** = Secret, server-side only (NEVER use in frontend)

**Example:**
```bash
VITE_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMjg1NjAwMCwiZXhwIjoxOTQ4NDMyMDAwfQ.xxxxx
```

3. **Save the file**
4. **IMPORTANT**: Add `.env.local` to `.gitignore` (so you don't commit secrets)

### Step 4.2: Test Locally
1. Restart dev server: `npm run dev`
2. Open http://localhost:8080
3. Test:
   - Click "Login" ‚Üí Try "Continue with Google" ‚Üí Should redirect to Google
   - Try newsletter subscription ‚Üí Should save to database
   - Check Supabase ‚Üí **Table Editor** ‚Üí `newsletter_subscribers` ‚Üí Should see emails

---

## PART 5: Deploy to Vercel

### Step 5.1: Push Code to GitHub
1. Create GitHub account if you don't have one: **https://github.com**
2. Create new repository:
   - Click **"New repository"**
   - Name: `ecofurnish` (or your choice)
   - Make it **Public** (or Private, your choice)
   - **Don't** initialize with README
   - Click **"Create repository"**

3. In your project terminal:
```bash
# Initialize git (if not already done)
git init

# Add all files
git add .

# Commit
git commit -m "Ready for deployment"

# Add remote (replace YOUR-USERNAME with your GitHub username)
git remote add origin https://github.com/YOUR-USERNAME/ecofurnish.git

# Push
git branch -M main
git push -u origin main
```

### Step 5.2: Deploy on Vercel
1. Go to **https://vercel.com**
2. Sign up with **GitHub** (recommended)
3. Click **"Add New Project"**
4. Import your GitHub repository:
   - Find `ecofurnish` (or your repo name)
   - Click **"Import"**
5. **Configure Project**:
   - **Framework Preset**: Vite (auto-detected)
   - **Root Directory**: `./` (default)
   - **Build Command**: `npm run build` ‚úÖ (This runs `vite build` - use npm)
   - **Output Directory**: `dist` (default)
   
   **Note**: Use `npm run build` (not `vite build` directly) - it's the standard way and ensures all npm scripts run correctly.
6. **Environment Variables**:
   - Click **"Environment Variables"**
   - Add:
     - **Name**: `VITE_SUPABASE_URL`
     - **Value**: Your Supabase Project URL
     - Click **"Add"**
   - Add:
     - **Name**: `VITE_SUPABASE_ANON_KEY`
     - **Value**: Your Supabase anon key
     - Click **"Add"**
7. Click **"Deploy"**
8. Wait 2-3 minutes for deployment

### Step 5.3: Get Your Vercel URL
1. After deployment, you'll get a URL like: `https://ecofurnish.vercel.app`
2. **Copy this URL** - you'll need it next

---

## PART 6: Configure Supabase for Production

### Step 6.1: Update Supabase Redirect URLs
1. Go to **Supabase** ‚Üí **Authentication** ‚Üí **URL Configuration**
2. Update:
   - **Site URL**: `https://your-vercel-url.vercel.app` (your Vercel URL)
   - **Redirect URLs**: Click **"Add URL"** and add:
     - `https://your-vercel-url.vercel.app`
   
   **Note**: 
   - Do NOT use wildcards (`**`) - they're not allowed
   - The callback URL (`/auth/v1/callback`) is automatically handled by Supabase
   - You only need to add your main app URL here - this is where users are redirected AFTER authentication
3. Click **"Save"**

### Step 6.2: Verify Google OAuth Callback URL
1. Go back to **Google Cloud Console**
2. **APIs & Services** ‚Üí **Credentials**
3. Click on your OAuth client
4. Under **"Authorized redirect URIs"**, you should see:
   - `https://YOUR-PROJECT-ID.supabase.co/auth/v1/callback` ‚úÖ
   
   **Important**: The callback URL should be the Supabase URL (already set in Step 3.3).
   You do NOT need to add your Vercel URL here - that goes in Supabase's URL Configuration.

**üìå IMPORTANT: Your Website Domain vs Auth Callback Domain**

**‚úÖ YOUR WEBSITE = Your Custom Domain (FREE!):**
- Your users visit: `https://yourdomain.com` ‚úÖ (your custom domain, FREE)
- Your website is hosted on: `https://yourdomain.com` ‚úÖ (Vercel + Namecheap, FREE)
- **This is what matters to users!** They see YOUR domain everywhere

**üîß AUTH CALLBACK = Technical Backend URL (Doesn't Matter to Users):**
- The auth callback URL: `https://YOUR-PROJECT-ID.supabase.co/auth/v1/callback`
- This is a **technical backend URL** that users never see
- It happens behind the scenes during Google login
- Users click "Login with Google" ‚Üí briefly redirects to Google ‚Üí redirects to Supabase (invisible) ‚Üí redirects back to `yourdomain.com`
- **Users end up on YOUR domain** - they never see the Supabase URL!

**Why Supabase is Better Than AWS:**
- ‚úÖ **100% FREE** (AWS charges for most services)
- ‚úÖ **Easier setup** (AWS requires complex IAM, Lambda, Cognito setup)
- ‚úÖ **Built-in auth** (AWS Cognito is complex and has free tier limits)
- ‚úÖ **PostgreSQL database included** (AWS RDS costs money)
- ‚úÖ **Automatic SSL** (AWS requires certificate management)
- ‚úÖ **No server management** (AWS requires EC2 or Lambda setup)

**Bottom Line:** Your website uses YOUR custom domain. The auth callback URL is just a technical detail users never see. Everything works perfectly! ‚úÖ

---

## PART 7: Connect Custom Domain (Namecheap)

**‚úÖ Custom Domains are FREE on Vercel!** 
- Vercel's free tier (Hobby plan) includes custom domain support
- No credit card required
- SSL certificates are automatically generated (FREE)

### Step 7.1: Add Domain in Vercel
1. In Vercel dashboard ‚Üí Your project ‚Üí **Settings** ‚Üí **Domains**
2. Enter your domain (e.g., `ecofurnish.com`)
3. Click **"Add"** or **"Continue"**
4. Vercel will show you **"Configuration"** with the EXACT DNS records you need
5. **IMPORTANT**: Write down or keep this page open - you'll need to copy these records to Namecheap
6. The configuration might show:
   - CNAME records (most common)
   - A records (if using IP addresses)
   - Or a combination of both

### Step 7.2: Configure DNS in Namecheap
1. Go to **https://www.namecheap.com**
2. Sign in ‚Üí **Domain List** ‚Üí Click **"Manage"** next to your domain
3. Go to **"Advanced DNS"** tab
4. **‚úÖ YES, CNAME-only works!** Vercel often uses CNAME records instead of IP addresses

**Add CNAME records (this is what Vercel usually shows):**

**Type CNAME Record 1 (Root Domain):**
- **Host**: `@` (your root domain)
- **Value**: `cname.vercel-dns.com.` (Vercel will show you the exact value - note the trailing dot)
- **TTL**: Automatic

**Type CNAME Record 2 (WWW Subdomain):**
- **Host**: `www`
- **Value**: `cname.vercel-dns.com.` (Vercel will show you the exact value - note the trailing dot)
- **TTL**: Automatic

**‚ö†Ô∏è Important Notes:**
- **CNAME-only configuration is fine!** You don't need an IP address (A record)
- **Always use what Vercel shows** in their dashboard - copy the records exactly
- If Namecheap doesn't allow CNAME for root domain (`@`), look for **"ALIAS Record"** or **"ANAME Record"** option
- Some registrars require ALIAS/ANAME for root domain CNAME functionality

5. Click **"Save"** (checkmark icon)
6. Wait 5-10 minutes for DNS to propagate (can take up to 24 hours)

**If Namecheap doesn't support CNAME for root domain (`@`):**
- In Namecheap, if you see an **"ALIAS Record"** or **"ANAME Record"** option, use that for the root domain instead of CNAME
- The `www` subdomain can still use regular CNAME
- Copy the exact values Vercel shows you

### Step 7.3: Verify Domain in Vercel
1. Go back to Vercel ‚Üí **Domains**
2. Wait for domain to show **"Valid Configuration"** (green checkmark)
3. SSL certificate is **automatically generated** (FREE!)

### Step 7.4: Update Supabase with Custom Domain
1. Go to **Supabase** ‚Üí **Authentication** ‚Üí **URL Configuration**
2. Update:
   - **Site URL**: `https://yourdomain.com`
   - **Redirect URLs**: Click **"Add URL"** and add:
     - `https://yourdomain.com`
   
   **Note**: 
   - Do NOT use wildcards (`**`) - they're not allowed
   - These are your app URLs (where users go after login)
   - The callback URL (`https://your-project-id.supabase.co/auth/v1/callback`) is already set in Google OAuth
3. Click **"Save"**

### Step 7.5: Verify Google OAuth Callback URL
1. Go to **Google Cloud Console** ‚Üí **Credentials**
2. Click on your OAuth client
3. Under **"Authorized redirect URIs"**, you should have:
   - `https://YOUR-PROJECT-ID.supabase.co/auth/v1/callback` ‚úÖ
   
   **Important**: Keep ONLY the Supabase callback URL here. 
   Your custom domain URLs are configured in Supabase (Step 7.4), not in Google Cloud Console.

---

## PART 8: Final Testing

### Test Everything:
1. ‚úÖ Visit your domain: `https://yourdomain.com`
2. ‚úÖ Test Google login ‚Üí Should work
3. ‚úÖ Test email signup ‚Üí Should work
4. ‚úÖ Test newsletter ‚Üí Should save to database
5. ‚úÖ Test contact buttons ‚Üí Should call/email
6. ‚úÖ Test category filtering ‚Üí Should work

---

## üìù Credentials Checklist

Save all these securely:

### Supabase
- [ ] Project URL: `https://xxxxx.supabase.co`
- [ ] Anon Public Key: `eyJhbGc...` ‚Üê **Use this one** (safe for frontend)
- [ ] Service Role Secret Key: `eyJhbGc...` ‚Üê **Keep secret** (server-side only, don't use in frontend)
- [ ] Database Password: `YourPassword123!`

### Google Cloud
- [ ] Client ID: `123456789-xxxxx.apps.googleusercontent.com`
- [ ] Client Secret: `GOCSPX-xxxxx`
- [ ] Project ID: `ecofurnish-xxxxx`

### Vercel
- [ ] Deployment URL: `https://xxxxx.vercel.app`
- [ ] Custom Domain: `yourdomain.com`

### Namecheap
- [ ] Domain: `yourdomain.com`
- [ ] Account login credentials

---

## üéâ You're Done!

Your site is now:
- ‚úÖ Live on your custom domain
- ‚úÖ Google OAuth working
- ‚úÖ Database connected
- ‚úÖ Newsletter saving emails
- ‚úÖ All features working
- ‚úÖ **100% FREE!**

---

## üêõ Troubleshooting

**Domain not working?**
- Wait 24-48 hours for DNS propagation
- Check Namecheap DNS records match Vercel exactly
- Make sure no trailing slashes in DNS values

**Google login not working?**
- Check redirect URI matches exactly (case-sensitive)
- Make sure Google provider is enabled in Supabase
- Check environment variables in Vercel

**Database errors?**
- Make sure you ran all SQL commands
- Check RLS policies are created
- Verify Supabase keys in Vercel environment variables

**Need help?** Check Supabase logs: Dashboard ‚Üí Logs

---

## üìû Support

If you get stuck:
1. Check Supabase documentation: https://supabase.com/docs
2. Check Vercel documentation: https://vercel.com/docs
3. Check browser console (F12) for errors

Good luck! üöÄ
